---
layout: post
title: myActiviti 是什么
description: 工作流是一个能够提高企业级应用开发生产力工具，而 myActiviti 是我们对它的扩展。
category: 工作流
date: 2017-12-06
list_number: false
---

## [为什么会出现工作流](#为什么会出现工作流)
工作流是企业级应用开发人员对于开发工作的一种抽象，它使得业务可以和代码完全分离。在没有使用工作流时，一旦应用发生业务流程上的变化，修改源代码成为家常便饭；使用工作流后，流程变更轻而易举，足以胜任不断变化的业务需求。因此工作流被看作企业应用的核心，使用它可以极大提高开发人员的生产力。

Activiti 是目前使用人数最多的开源工作流，它定义的 BPMN 标准已经成为工作流业界事实上的标准。但是，西方工作流中并没有撤回、驳回的概念，一旦发送即发送；而中国式工作流需要各种撤回、驳回和跳转（包括有历史记录和无历史记录），因此又称之为中国流。显然，简单使用 Activiti 是无法满足中国式办公需求的，因此 myActiviti 出来填补了这一空白。

myActiviti 是基于 Activiti-6 的深度改造，它一方面继承了 Activiti 易于上手的优点，另一方面加入了中国流特性和微服务特性。因此学习并使用 myActiviti 可以以极低的成本满足您的业务需求，并且，假如您想切换为其它符合 BPMN 标准的工作流引擎，您也不需要做太多额外的工作，因为您最重要的资产 “流程图” 是可以完全复用的。

## [如何访问 myActiviti](#如何访问-myActiviti)
myActiviti 的访问地址为内网 [http://10.0.209.147/myactiviti/explorer/#/user/login](http://10.0.209.147/myactiviti/explorer/#/user/login)，点击后会出现如下登录页面：
{% asset_img login.png %}

这是 myActiviti 的测试环境，目前提供以下测试帐号，这些账号均拥有高级用户权限，可以使用本文档提到的所有功能。

| 用户名     | 密码   |
|:--------|-------:|
| `leader` | `lea1der` |
| `manager` | `manag2er` |
| `dean` | `d3ean` |
| `finance` | `4finance` |
| `tmo` | `tmo5` |

当登录后您可以看到如下所示的一级菜单：

{% asset_img menu_model.png %}

一级菜单默认选中 `任务`，这是用户查看指派给自己任务的界面。但我们现在的任务是设计流程图，所以我们选中 `流程`：

{% asset_img menu_process.png %}

然后，我们开始设计一个简单的流程图。

## [如何设计一个流程图](#如何设计一个流程图)
选中 `流程` 后，下方会出现如下所示的二级菜单：

{% asset_img model_banner.png %}

二级菜单默认选中 `已部署流程定义`，在这个界面可以启动流程。但现在我们还没有流程图，所以我们选中 `流程设计工作区`：

{% asset_img model_panel.png %}

二级菜单的右方如下所示：

{% asset_img model_panel2.png %}

我们选中 `新建模型`，然后出现新增窗口：

{% asset_img model_create.png %}

在这里我们把新模型命名为“myProcess”，您可以按喜好添加描述，然后首选设计器保持 `Activiti Modeler` 不变，点击“创建”，进入如下界面，关于这个设计页面的各种功能我们会在下一篇文档中详细介绍。

{% asset_img modeler.png %}

我们将 `开始事件-普通开始事件`、`任务-邮件任务`、`结束事件-普通结束事件` 三个元素拖拽到右边工作区，然后用序列流将它们连起来，如下：

{% asset_img process_mail2.png %}

我们的目的是通过简单的流程图展示 myActiviti 流程的生命周期，所以创建了一个邮件任务，这个流程图干的事情很简单，当它启动时，向指定的邮箱发送指定的内容，然后结束。

为了让这个流程真正能跑起来，我们还需要做一些事情。首先，您应该能注意到工作区下方有一个输入区，您可以通过点击输入区来显示/隐藏它。当您选中工作区的<b>任何</b>元素，下方都会切换到此元素对应的输入区，当您不选中工作区的元素时，下方会切换到此流程图本身的输入区，如下：

{% asset_img modeler_input.png %}

其中 `流程ID` 和 `元素名称` 都为必填项，`流程ID` 的输入规则是：只能输入大小写字母、数字和下横线“_”，且不能以数字开头，长度不超过40；`元素名称` 没有以上限制，但长度不要超过100。
（如果您违反以上命名规则，某些情况下可以保存，但在之后部署和运行时会出现问题。）

您在这里输入 `流程ID` 和 `元素名称` 后，还需要输入邮件的相关信息，因此需要选中 `邮件任务`，然后在输入区输入 `邮件接收方`、`邮件主题`、`邮件文本内容`。如果您想发送 Html 格式的邮件，您就在 `邮件Html内容` 中输入邮件内容（这里会覆盖文本内容），还要在 `字符编码` 中输入“utf8”。

至此，您的第一个流程已经可以保存部署并执行了，但是，为了让流程图清晰可读，我们建议您给 `邮件任务` 加上 `ID` 和 `元素名称`，它们的输入限制与流程图的 `流程ID` 和 `元素名称` 相同。我们输入名称“发邮件”并随意输入一个可用的ID，之后工作区会变成如下所示：

{% asset_img process_mail3.png %}

然后点击工作区上方左边第一个按钮，出现保存窗口：

{% asset_img modeler_save.png %}

您可以按喜好添加一些 `描述`，至于 `关联业务`，我们在下一章会详细介绍，现在可以不填，然后点击 `保存并关闭编辑器` 就完成了您第一个流程图的全部设计工作。

## [如何部署和运行流程图](#如何部署和运行流程图)
如果一切顺利，现在您应该处于二级菜单 `流程设计工作区` 界面下，并且默认选中了刚刚保存的流程，我们点击右上角的 `处理模型` 下拉框，如下：

{% asset_img deploy.png %}

{% asset_img process_banner.png %}

然后选择 `部署`。稍等片刻，如果一切顺利，您会处于一级菜单 `管理` 界面下，我们暂时不管这里，点击一级菜单 `流程`。此时您已经可以看到部署好的流程，但它是以流程的 `元素名称` 命名的，现在右上方可使用的功能如下：

{% asset_img process_panel.png %}

{% asset_img process_panel2.png %}

{% asset_img process_detail.png %}

点选您的流程，然后点击右上角的 `启动流程`，现在，一封邮件已经发到了您设计流程图时指定的邮箱里，然后流程自动结束，到邮箱去看看吧。

## [总结](#总结)
- 如果用 Java 来比喻流程开发的话，设计流程图可以比作开发代码，部署流程图可以比作将代码编译为机器码文件，运行已部署流程可以比作执行机器码文件。

- 本工作流已经默认配置了一个 no-reply 邮箱，所以您可以给任何指定邮箱发邮件，但大多数情况下这个邮件会被当成垃圾邮件。如果工作流配置正规的邮件服务器后，这个流程就可以在正式场合使用。

- 这个发邮件的流程只是 myActiviti 功能的冰山一角，仅为了说明工作流的基本概念，更多的内容请看下一篇文章。