---
layout: post
title: myActiviti 是什么
description: 工作流是一个能够提高企业级应用开发生产力工具，而 myActiviti 是我们对它的扩展。
category: 工作流
date: 2017-12-06
list_number: false
---

## [为什么会出现工作流](#为什么会出现工作流)
工作流是企业级应用开发人员对于开发工作的一种抽象，它使得业务可以和代码完全分离。在没有使用工作流时，一旦应用发生业务流程上的变化，修改源代码成为家常便饭；使用工作流后，流程变更轻而易举，足以胜任不断变化的业务需求。因此工作流被看作企业应用的核心，使用它可以极大提高开发人员的生产力。

Activiti 是目前使用人数最多的开源工作流，它定义的 BPMN 标准已经成为工作流业界事实上的标准。但是，西方工作流中并没有撤回、驳回的概念，一旦发送即发送；而中国式工作流需要各种撤回、驳回和跳转（包括有历史记录和无历史记录），因此又称之为中国流。显然，简单使用 Activiti 是无法满足中国式办公需求的，因此 myActiviti 出来填补了这一空白。

myActiviti 是基于 Activiti-6 的深度改造，它一方面继承了 Activiti 易于上手的优点，另一方面加入了中国流特性和微服务特性。因此学习并使用 myActiviti 可以以极低的成本满足您的业务需求，并且，假如您想切换为其它符合 BPMN 标准的工作流引擎，您也不需要做太多额外的工作，因为您最重要的资产 “流程图” 是可以完全复用的。

## [如何访问 myActiviti](#如何访问-myActiviti)
myActiviti 的访问地址为内网 [http://10.0.209.147/myactiviti/explorer/#/user/login](http://10.0.209.147/myactiviti/explorer/#/user/login)，点击后会出现如下登录页面：
{% asset_img login_4.png %}

这是 myActiviti 的测试环境，目前提供以下测试帐号，这些账号均拥有高级用户权限，可以使用本文档提到的所有功能。

| 用户名     | 密码   |
|:--------|-------:|
| `ada@test.org` | `ada1ada` |
| `bob@test.org` | `bob2bob` |
| `carl@test.org` | `carl3carl` |
| `duke@test.org` | `duke4duke` |
| `eli@test.org` | `eli5eli` |

当登录后您可以在左方看到如下所示的一级菜单：

{% asset_img menu_model.png %}

一级菜单默认选中 `模型设计区`，这是用户管理自己模型的界面，如果您需要管理部署好的流程，就点选 `已部署流程`：

{% asset_img menu_process.png %}

现在，我们从设计一个简单的模型开始说起。

## [如何设计一个流程图](#如何设计一个流程图)
选中 `模型设计区` 后，右方会出现如下所示的二级菜单：

{% asset_img model_banner.png %}

上图中 `新建` 按钮用于建立新模型，`导入` 按钮用于将 “bpmn20.xml”文件导入到工作流平台中，`刷新` 按钮用于刷新下方模型列表，搜索框可以按模型名称进行搜索。下面我们点选 `新建`，然后出现新建模型窗口：

{% asset_img model_create.png %}

在这里我们把新模型命名为“myProcess”，您可以按喜好添加描述，然后首选设计器保持 `Activiti Modeler` 不变，点击“创建”，进入如下界面，关于这个设计页面的各种功能我们会在下一篇文档中详细介绍。

{% asset_img modeler.png %}

我们将 `开始事件-普通开始事件`、`任务-邮件任务`、`结束事件-普通结束事件` 三个元素拖拽到右边工作区，然后用序列流将它们连起来，如下：

{% asset_img process_mail2.png %}

我们的目的是通过简单的流程图展示 myActiviti 流程的生命周期，所以创建了一个邮件任务，这个流程图干的事情很简单，当它启动时，向指定的邮箱发送指定的内容，然后结束。

为了让这个流程真正能跑起来，我们还需要做一些事情。首先，您应该能注意到工作区下方有一个输入区，您可以通过点击输入区来显示/隐藏它。当您选中工作区的<b>任何</b>元素，下方都会切换到此元素对应的输入区，当您不选中工作区的元素时，下方会切换到此流程图本身的输入区，如下：

{% asset_img modeler_input.png %}

其中 `流程ID` 和 `元素名称` 都为必填项，`流程ID` 的输入规则是：只能输入大小写字母、数字和下横线“_”，且不能以数字开头，长度不超过40；`元素名称` 没有以上限制，但长度不要超过100。
（如果您违反以上命名规则，某些情况下可以保存，但在之后部署和运行时会出现问题。）

您在这里输入 `流程ID` 和 `元素名称` 后，还需要输入邮件的相关信息，因此需要选中 `邮件任务`，然后在输入区输入 `邮件接收方`、`邮件主题`、`邮件文本内容`。如果您想发送 Html 格式的邮件，您就在 `邮件Html内容` 中输入邮件内容（这里会覆盖文本内容），还要在 `字符编码` 中输入“utf8”。

至此，您的第一个流程已经可以保存部署并执行了，但是，为了让流程图清晰可读，我们建议您给 `邮件任务` 加上 `ID` 和 `元素名称`，它们的输入限制与流程图的 `流程ID` 和 `元素名称` 相同。我们输入名称“发邮件”并随意输入一个可用的ID，之后工作区会变成如下所示：

{% asset_img process_mail3.png %}

然后点击工作区上方左边第一个按钮，出现保存窗口：

{% asset_img modeler_save_3.png %}

您可以按喜好添加一些 `描述`，然后点击 `保存并关闭编辑器` 就完成了您的第一个流程图，这时我们会发现下方的模型列表中多出来一条记录：

{% asset_img model_panel.png %}

当鼠标放到 `更多` 上时，会出现更多操作，如下：

{% asset_img model_panel2.png %}

这些都是对此模型的管理操作，您不妨亲自尝试一下它们的效果。

## [如何部署流程](#如何部署流程)
如果您的模型已经设计完毕，就点选它对应的 `部署` 按钮，然后会弹出如下窗口：

{% asset_img deploy.png %}

在这里输入一个独一无二的业务标识后，点击 `确定` 即可。关于业务标识的含义我们在下一节会详细介绍。

## [如何查看已部署流程](#如何查看已部署流程)
选中左侧菜单中的 `已部署流程` 后，右方会出现如下所示的二级菜单：

{% asset_img process_banner.png %}

上图中搜索框可以按流程名称进行搜索，在下方流程列表中可以找到刚刚部署的流程：

{% asset_img process_panel.png %}

{% asset_img process_panel2.png %}

点击 `更多` 中的 `详情` 可以看到该流程的详细信息，如下：

{% asset_img process_detail.png %}

点选对应此流程的 `启动`，现在，一封邮件已经发到了您设计流程图时指定的邮箱里，然后流程自动结束，请到邮箱去看看吧。

## [总结](#总结)
- 如果用 Java 来比喻流程开发的话，设计流程图可以比作开发代码，部署流程图可以比作将代码编译为机器码文件，运行已部署流程可以比作执行机器码文件。

- 本工作流已经默认配置了一个 no-reply 邮箱，所以您可以给任何指定邮箱发邮件，但大多数情况下这个邮件会被当成垃圾邮件。如果工作流配置正规的邮件服务器后，这个流程就可以在正式场合使用。

- 这个发邮件的流程只是 myActiviti 功能的冰山一角，仅为了说明工作流的基本概念，更多的内容请看下一篇文章。